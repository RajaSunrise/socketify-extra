name: Linux ARM64 Build

on:
  push:
    branches:
      - main

jobs:
  build-linux-arm64:
    runs-on: ubuntu-20.04
    name: Build for Linux ARM64
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Clone repository
        run: |
          git clone --recursive https://github.com/RajaSunrise/socketify-extra.git
          cd socketify-extra/socketify_extra/native

      - name: Build for ARM64 using Docker
        run: |
          docker run --rm -v "$(pwd)":/usr/src/myapp -w /usr/src/myapp gcc-arm64 make PLATFORM=arm64 linux

      - name: Commit and push changes
        run: |
          cd socketify-extra
          git config --global user.email "rajasunsrise@gmail.com"
          git config --global user.name "RajaSunrise"
          git add socketify_extra/libsocketify_linux_arm64.so
          git commit -m "[GitHub Actions] Updated linux-arm64 binaries" || true
          git push origin -f https://RajaSunrise:${{ secrets.BUILDTOKEN }}@github.com/RajaSunrise/socketify-extra.git
